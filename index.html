<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
        background-color: black;
      }
      canvas {
        border-width: 1px;
        border-color: #454545;
        border-style: solid;
      }
    </style>
  </head>
  <body>
    <canvas id="myCanvas" width="1681" height="400"></canvas>
    <script>
      window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame ||
               window.webkitRequestAnimationFrame ||
               window.mozRequestAnimationFrame ||
               window.oRequestAnimationFrame ||
               window.msRequestAnimationFrame ||
               function(callback) {
                 window.setTimeout(callback, 1000 / 60);
               };
      })();

      function drawRectangle(myRectangle, context) {
        context.beginPath();
        context.rect(myRectangle.x, myRectangle.y, myRectangle.width, myRectangle.height);
        // context.fillStyle = '#0363B6';
        context.fillStyle = myRectangle.color;
        context.fill();
        context.lineWidth = myRectangle.borderWidth;
        // context.strokeStyle = '#4CB1FF';
        context.strokeStyle = myRectangle.strokeColor;
        context.stroke();
      }

      // function animate(myRectangle, canvas, context, linearSpeed) {
      function animate(rectangles, canvas, context) {
        // update
        context.clearRect(0, 0, canvas.width, canvas.height);

        rectangles.forEach(function(myRectangle) {
          var linearSpeed = myRectangle.linearSpeed || 1;
          // pixels / second
          var newX = myRectangle.x + myRectangle.linearSpeed;

          if (newX < 0) {
            myRectangle.linearSpeed = -myRectangle.linearSpeed;
          } else if (newX < (canvas.width - myRectangle.width - myRectangle.borderWidth / 2)) {
            myRectangle.x = newX;
          } else {
            myRectangle.linearSpeed = -myRectangle.linearSpeed;
          }

          drawRectangle(myRectangle, context);
        })

        // request new frame
        requestAnimFrame(function() {
          animate(rectangles, canvas, context);
        });
      }

      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      function generateRectangles(rectangleCount, colors, canvas) {
        var rectangles = [];
        for (step = 0; step < rectangleCount; step++) {
          var randomSeed = Math.floor(Math.random()),
              randomColorSeed = Math.floor(Math.random() * colors.length),
              randomXSeed = Math.floor(Math.random() * (canvas.width / 2)),
              randomYSeed = Math.floor(canvas.height * ((step + 1) / rectangleCount)),
              randomLinearSpeed = Math.floor(Math.random() * 3),
              randomWidth = Math.floor(Math.random() * (canvas.width / 2));
          var rectangleColor = colors[randomColorSeed];
          rectangles.push({
            x: randomXSeed,
            y: randomYSeed,
            width: randomWidth < 400 ? 400 : randomWidth,
            height: 5,
            borderWidth: 1,
            linearSpeed: randomLinearSpeed < 1 ?
                         randomSeed == 1 ? 1 : -1 :
                         randomSeed == 0 ? randomLinearSpeed : -randomLinearSpeed,
            color: rectangleColor,
            strokeColor: '#4CB1FF'
          });
        }
        return rectangles;
      }

      var colors = ['#6FC2F2', '#0363B6', '#454545', '#000000'];
      // light blue, dark blue, light black, dark black
      var rectangles = generateRectangles(50, colors, canvas);

      rectangles.forEach(function(rectangle) {
        drawRectangle(rectangle, context);
      })
      // drawRectangle(myRectangle, context);
      // drawRectangle(myRectangle2, context);

      // wait one second before starting animation
      setTimeout(function() {
        animate(rectangles, canvas, context);
      }, 1000);
    </script>
  </body>
</html>
